{% extends "base.html" %}
{% block content %}
  <div class="container mt-4">
    <div class="card">
      <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
        <h5 class="mb-0">
          <i class="bi bi-trophy-fill me-2"></i>{{ token }} Full Richlist
        </h5>
        <a href="{{ url_for('export_richlist_csv', token=token) }}" class="btn btn-outline-light btn-sm"><i
          class="bi bi-download me-1"></i>Export CSV</a>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Rank</th>
                <th>Account</th>
                <th>Balance</th>
                <th>Stake</th>
                <th>Pending Unstake</th>
                <th>Delegations In</th>
                <th>Delegations Out</th>
                <th>Pending Undelegation</th>
                <th>Total</th>
                <th>Percentage</th>
              </tr>
            </thead>
            <tbody>
              {% for holder in richlist %}
                <tr>
                  <td>{{ loop.index }}</td>
                  <td>{{ holder.account }}</td>
                  <td>{{ holder.balance | fmt(',.8f') }}</td>
                  <td>{{ holder.stake | fmt(',.8f') }}</td>
                  <td>{{ holder.pendingUnstake | fmt(',.8f') }}</td>
                  <td>{{ holder.delegationsIn | fmt(',.8f') }}</td>
                  <td>{{ holder.delegationsOut | fmt(',.8f') }}</td>
                  <td>{{ holder.pendingUndelegations | fmt(',.8f') }}</td>
                  {% set balance = holder.balance | float if holder.balance is not none else 0 %}
                  {% set stake = holder.stake | float if holder.stake is not none else 0 %}
                  {% set total_balance = balance + stake %}
                  <td>{{ total_balance | fmt(',.8f') }}</td>
                  <td>
                    {% set total_supply = token_info.supply | float if token_info.supply is not none else 1 %}
                    {% set total_percentage = (total_balance / total_supply) * 100 %}
                    {{ total_percentage | fmt(',.2f') }}%
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
